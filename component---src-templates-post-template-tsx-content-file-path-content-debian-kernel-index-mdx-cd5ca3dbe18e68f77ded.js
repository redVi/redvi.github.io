"use strict";(self.webpackChunkgatsby_blog=self.webpackChunkgatsby_blog||[]).push([[36],{768:function(e,n,a){a.r(n),a.d(n,{Head:function(){return o.Ss},default:function(){return p}});var l=a(8876),t=a(4424),s=a(8860);function c(e){const n=Object.assign({p:"p",ul:"ul",li:"li",span:"span"},(0,l.MN)(),e.components);return t.createElement(t.Fragment,null,t.createElement(n.p,null,"Цель данной статьи — показать пользователям, что такое страшное словосочетание как «компиляция ядра» вовсе не так уж и страшно, и даже довольно просто, если всё делать вдумчиво."),"\n",t.createElement(n.p,null,"Когда и зачем это нужно?"),"\n",t.createElement(n.ul,null,"\n",t.createElement(n.li,null,"если ваше оборудование специфично"),"\n",t.createElement(n.li,null,"для поддержки нестандартных возможностей, не включенных в стандартное ядро"),"\n",t.createElement(n.li,null,"для оптимизации"),"\n",t.createElement(n.li,null,"если в силу каких-то причин вам необходима более новая версия ядра"),"\n"),"\n",t.createElement(n.p,null,"В примере будет разобрана не просто перекомпиляция уже имеющегося ядра, а как раз установка и последующая сборка более нового."),"\n",t.createElement(n.p,null,"Для подобного дела нужно сначала подготовиться. А именно заняться установкой следующих пакетов:"),"\n",t.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ <span class="token function">sudo</span> <span class="token function">aptitude</span> <span class="token function">install</span> build-essential kernel-package fakeroot initrd-tools pkg-config libncurses5-dev\n<span class="token comment">## (и `linux-source` - для тех, кто перекомпилирует имеющееся ядро)</span></code></pre></div>'}}),"\n",t.createElement(n.p,null,"Если вы решили ставить новое ядро, то идём на kernel.org  или зеркало yandex — ",t.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">mirror.yandex.ru/kernel.org/linux/kernel/</code>'}})," — и скачиваем необходимую версию ядра. У нас это ",t.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">linux-3.0.4.tar.bz2</code>'}}),"."),"\n",t.createElement(n.p,null,"Смотрим есть ли пакет ",t.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">linux-source</code>'}})," в каталоге ",t.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">/usr/src</code>'}}),". В случае с перекомпиляцией он будет, если вы скачали новое ядро, то переместите его туда."),"\n",t.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ <span class="token function">ls</span> /usr/src/\nlinux-source-3.0.4.tar.bz2</code></pre></div>'}}),"\n",t.createElement(n.p,null,"Переходим в каталог и распаковываем архив:"),"\n",t.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ <span class="token builtin class-name">cd</span> /usr/src\n$ <span class="token function">sudo</span> <span class="token function">tar</span> xjf linux-source-3.0.4.tar.bz2</code></pre></div>'}}),"\n",t.createElement(n.p,null,"Идём в созданную после разархивирования директорию:"),"\n",t.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ <span class="token builtin class-name">cd</span> linux-source-3.0.4/</code></pre></div>'}}),"\n",t.createElement(n.p,null,"Теперь можно заняться конфигурированием ядра. Автором это было сделано в консоли с остановленным X-Window. В таком случае пишем от рута:"),"\n",t.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token comment"># make menuconfig</span></code></pre></div>'}}),"\n",t.createElement(n.p,null,"Если желаете конфигурировать в графическом терминале, вам послужит команда"),"\n",t.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token comment"># make xconfig</span></code></pre></div>'}}),"\n",t.createElement(n.p,null,"Но понадобится установить дополнительные пакеты/библиотеки, в общем ну её...."),"\n",t.createElement(n.p,null,"С конфигурацией закончили? Тогда собираем наше новенькое ядрышко:"),"\n",t.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token comment"># fakeroot make-kpkg --initrd --revision=debian.3.0.4 kernel_image</span></code></pre></div>'}}),"\n",t.createElement(n.p,null,"В ",t.createElement(n.span,{dangerouslySetInnerHTML:{__html:"<code class=\"language-text\">'--revision'</code>"}})," можете выставить свои названия/значения вместо приведённых здесь debian и 3.0.4"),"\n",t.createElement(s.y,{heading:"Осторожно!",type:"warning"},t.createElement(n.p,null,"Выше был приведён способ сборки ядра в стиле debian way. К сожалению, иногда\nэто может не сработать.")),"\n",t.createElement(n.p,null,"«не сработать» — это когда сборка останавливается с ошибкой\nкомпиляции"),"\n",t.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token punctuation">..</span><span class="token punctuation">..</span>.\nmake: *** Documentation/lguest: Нет такого файла или каталога. Останов.\nmake: *** <span class="token punctuation">[</span>debian/stamp/build/kernel<span class="token punctuation">]</span> Ошибка <span class="token number">2</span>-------------------------</code></pre></div>'}}),"\n",t.createElement(n.p,null,"Довольно известный баг дебиана. Тогда собираем ядро как все люди:"),"\n",t.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token comment"># make mrproper</span>\n<span class="token comment"># make menuconfig</span>\n<span class="token comment"># make &amp;&amp; make modules_install</span>\n<span class="token comment"># cp arch/$ARCH/boot/bzImage /boot/linux-$VERSION</span></code></pre></div>'}}),"\n",t.createElement(n.p,null,"где ",t.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">$VERSION</code>'}})," — версия вашего ядра."),"\n",t.createElement(n.p,null,"После долгого (или не очень) компилирования установим ядро как обычный пакет в debian (для тех, кто собирал по первому способу)."),"\n",t.createElement(n.p,null,"Ядро будет располагаться в директории ",t.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">/usr/src</code>'}})),"\n",t.createElement(n.p,null,"Мы уже там, так что даём команду:"),"\n",t.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token comment"># dpkg -i ./linux-image-3.0.4_debian.3.0.4_amd64.deb</span></code></pre></div>'}}),"\n",t.createElement(n.p,null,"И перезагружаемся"),"\n",t.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token comment"># reboot</span></code></pre></div>'}}),"\n",t.createElement(n.p,null,"В итоге при следующем старте системы получаем целых два ядра. Пробуем загрузиться с новым, если напортачили, имеем возможность выбрать из списка загрузки предыдущее ядро."))}var r=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,l.MN)(),e.components);return n?t.createElement(n,e,t.createElement(c,e)):c(e)},o=a(7792),u=a(7619);function g(e){var n,a;let{data:{mdx:l},children:s,pageContext:{prev:c,next:r}}=e;const{h1:g,title:p,description:i,image:m,table_of_contents:d}=l.frontmatter;return(0,t.useEffect)((()=>{(0,u.K)()}),[]),t.createElement(t.Fragment,null,t.createElement(o._W,{h1:g,title:p,description:i,image:null===(n=l.frontmatter.image)||void 0===n?void 0:n.publicURL},t.createElement(o.MV,{post:l.frontmatter,imageData:null==m||null===(a=m.childImageSharp)||void 0===a?void 0:a.gatsbyImageData},d?t.createElement(o.G8,{headings:l.tableOfContents}):null,t.createElement("div",{className:"page__content"},s,t.createElement(o.Mf,{prev:c,next:r})),t.createElement(o.QZ,null))))}function p(e){return t.createElement(g,e,t.createElement(r,e))}},8860:function(e,n,a){a.d(n,{y:function(){return l.y}});var l=a(3836)},8876:function(e,n,a){a.d(n,{MN:function(){return s}});var l=a(4424);const t=l.createContext({});function s(e){const n=l.useContext(t);return l.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}}}]);