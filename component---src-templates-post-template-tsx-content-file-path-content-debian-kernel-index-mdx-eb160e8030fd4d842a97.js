"use strict";(self.webpackChunkgatsby_blog=self.webpackChunkgatsby_blog||[]).push([[36],{768:function(e,n,l){l.r(n),l.d(n,{Head:function(){return m.Ss},default:function(){return i}});var t=l(8876),a=l(4424),r=l(8860);function c(e){const n=Object.assign({p:"p",ul:"ul",li:"li",pre:"pre",code:"code"},(0,t.MN)(),e.components);return a.createElement(a.Fragment,null,a.createElement(n.p,null,"Цель данной статьи — показать пользователям, что такое страшное словосочетание как «компиляция ядра» вовсе не так уж и страшно, и даже довольно просто, если всё делать вдумчиво."),"\n",a.createElement(n.p,null,"Когда и зачем это нужно?"),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,"если ваше оборудование специфично"),"\n",a.createElement(n.li,null,"для поддержки нестандартных возможностей, не включенных в стандартное ядро"),"\n",a.createElement(n.li,null,"для оптимизации"),"\n",a.createElement(n.li,null,"если в силу каких-то причин вам необходима более новая версия ядра"),"\n"),"\n",a.createElement(n.p,null,"В примере будет разобрана не просто перекомпиляция уже имеющегося ядра, а как раз установка и последующая сборка более нового."),"\n",a.createElement(n.p,null,"Для подобного дела нужно сначала подготовиться. А именно заняться установкой следующих пакетов:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-shell"},"$ sudo aptitude install build-essential kernel-package fakeroot initrd-tools pkg-config libncurses5-dev\n## (и `linux-source` - для тех, кто перекомпилирует имеющееся ядро)\n")),"\n",a.createElement(n.p,null,"Если вы решили ставить новое ядро, то идём на kernel.org  или зеркало yandex — ",a.createElement(n.code,null,"mirror.yandex.ru/kernel.org/linux/kernel/")," — и скачиваем необходимую версию ядра. У нас это ",a.createElement(n.code,null,"linux-3.0.4.tar.bz2"),"."),"\n",a.createElement(n.p,null,"Смотрим есть ли пакет ",a.createElement(n.code,null,"linux-source")," в каталоге ",a.createElement(n.code,null,"/usr/src"),". В случае с перекомпиляцией он будет, если вы скачали новое ядро, то переместите его туда."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-shell"},"$ ls /usr/src/\nlinux-source-3.0.4.tar.bz2\n")),"\n",a.createElement(n.p,null,"Переходим в каталог и распаковываем архив:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-shell"},"$ cd /usr/src\n$ sudo tar xjf linux-source-3.0.4.tar.bz2\n")),"\n",a.createElement(n.p,null,"Идём в созданную после разархивирования директорию:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-shell"},"$ cd linux-source-3.0.4/\n")),"\n",a.createElement(n.p,null,"Теперь можно заняться конфигурированием ядра. Автором это было сделано в консоли с остановленным X-Window. В таком случае пишем от рута:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-shell"},"# make menuconfig\n")),"\n",a.createElement(n.p,null,"Если желаете конфигурировать в графическом терминале, вам послужит команда"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-shell"},"# make xconfig\n")),"\n",a.createElement(n.p,null,"Но понадобится установить дополнительные пакеты/библиотеки, в общем ну её...."),"\n",a.createElement(n.p,null,"С конфигурацией закончили? Тогда собираем наше новенькое ядрышко:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-shell"},"# fakeroot make-kpkg --initrd --revision=debian.3.0.4 kernel_image\n")),"\n",a.createElement(n.p,null,"В ",a.createElement(n.code,null,"'--revision'")," можете выставить свои названия/значения вместо приведённых здесь debian и 3.0.4"),"\n",a.createElement(r.y,{heading:"Осторожно!",type:"warning"},a.createElement(n.p,null,"Выше был приведён способ сборки ядра в стиле debian way. К сожалению, иногда\nэто может не сработать.")),"\n",a.createElement(n.p,null,"«не сработать» — это когда сборка останавливается с ошибкой\nкомпиляции"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-shell"},".....\nmake: *** Documentation/lguest: Нет такого файла или каталога. Останов.\nmake: *** [debian/stamp/build/kernel] Ошибка 2-------------------------\n")),"\n",a.createElement(n.p,null,"Довольно известный баг дебиана. Тогда собираем ядро как все люди:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-shell"},"# make mrproper\n# make menuconfig\n# make && make modules_install\n# cp arch/$ARCH/boot/bzImage /boot/linux-$VERSION\n")),"\n",a.createElement(n.p,null,"где ",a.createElement(n.code,null,"$VERSION")," — версия вашего ядра."),"\n",a.createElement(n.p,null,"После долгого (или не очень) компилирования установим ядро как обычный пакет в debian (для тех, кто собирал по первому способу)."),"\n",a.createElement(n.p,null,"Ядро будет располагаться в директории ",a.createElement(n.code,null,"/usr/src")),"\n",a.createElement(n.p,null,"Мы уже там, так что даём команду:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-shell"},"# dpkg -i ./linux-image-3.0.4_debian.3.0.4_amd64.deb\n")),"\n",a.createElement(n.p,null,"И перезагружаемся"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-shell"},"# reboot\n")),"\n",a.createElement(n.p,null,"В итоге при следующем старте системы получаем целых два ядра. Пробуем загрузиться с новым, если напортачили, имеем возможность выбрать из списка загрузки предыдущее ядро."))}var u=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,t.MN)(),e.components);return n?a.createElement(n,e,a.createElement(c,e)):c(e)},m=l(7792),o=l(7619);function s(e){var n,l;let{data:{mdx:t},children:r,pageContext:{prev:c,next:u}}=e;const{h1:s,title:i,description:E,image:p,table_of_contents:d}=t.frontmatter;return(0,a.useEffect)((()=>{(0,o.K)()}),[]),a.createElement(a.Fragment,null,a.createElement(m._W,{h1:s,title:i,description:E,image:null===(n=t.frontmatter.image)||void 0===n?void 0:n.publicURL},a.createElement(m.MV,{post:t.frontmatter,imageData:null==p||null===(l=p.childImageSharp)||void 0===l?void 0:l.gatsbyImageData},d?a.createElement(m.G8,{headings:t.tableOfContents}):null,a.createElement("div",{className:"page__content"},r,a.createElement(m.Mf,{prev:c,next:u})),a.createElement(m.QZ,null))))}function i(e){return a.createElement(s,e,a.createElement(u,e))}},8860:function(e,n,l){l.d(n,{y:function(){return t.y}});var t=l(3836)},8876:function(e,n,l){l.d(n,{MN:function(){return r}});var t=l(4424);const a=t.createContext({});function r(e){const n=t.useContext(a);return t.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}}}]);