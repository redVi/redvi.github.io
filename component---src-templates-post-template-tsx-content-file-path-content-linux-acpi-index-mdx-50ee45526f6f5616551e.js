"use strict";(self.webpackChunkgatsby_blog=self.webpackChunkgatsby_blog||[]).push([[7348],{2148:function(e,n,l){l.r(n),l.d(n,{Head:function(){return o.Ss},default:function(){return i}});var t=l(8876),a=l(4424);function c(e){const n=Object.assign({p:"p",code:"code",h2:"h2",a:"a",span:"span",pre:"pre",ul:"ul",li:"li"},(0,t.MN)(),e.components);return a.createElement(a.Fragment,null,a.createElement(n.p,null,'Трудно приходится линуксоидам, не имеющим DE, а\nсидящим исключительно на WM — всё, что в полноценном Desktop\nEnvironment ( окружении рабочего стола или как это лучше обозначить\nна великом и могучем? ) поставляется и работает "из коробки" в WM нужно\nподбирать и настраивать. Вот и автором сего поста ранее были использованы\nэлементы xfce для таких вещей как управление питанием, регулировка громкости\nзвука и яркости экрана. Но вступило что-то в голову: ведь в моей системе всегда\nустановлены acpi и laptop-mode-tools, так почему бы не обучить их выполнять их\nже непосредственные обязанности: делать всё то, для чего раньше нужны были\nxfce4-volumed и xfce4-power-manager?'),"\n",a.createElement(n.p,null,"Для обучения нам понадобятся пакеты ",a.createElement(n.code,null,"laptop-mode-tools"),", ",a.createElement(n.code,null,"acpi"),",\n",a.createElement(n.code,null,"acpid"),". Acpid должен быть запущен."),"\n",a.createElement(n.h2,{id:"уровень-яркости-экрана",style:{position:"relative"}},a.createElement(n.a,{href:"#%D1%83%D1%80%D0%BE%D0%B2%D0%B5%D0%BD%D1%8C-%D1%8F%D1%80%D0%BA%D0%BE%D1%81%D1%82%D0%B8-%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0","aria-label":"уровень яркости экрана permalink",className:"anchor before"},a.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Уровень яркости экрана"),"\n",a.createElement(n.p,null,"Дописать в ",a.createElement(n.code,null,"/etc/default/grub")," строки:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-bash"},'GRUB_CMDLINE_LINUX_DEFAULT="acpi_backlight=vendor resume=/dev/sda5"\n')),"\n",a.createElement(n.p,null,"Лезем в acpi. Создайте файлы со следующим содержанием."),"\n",a.createElement(n.p,null,"Для увеличения яркости:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-bash"},"# /etc/acpi/actions/bl_up.sh\n\n#!/bin/sh\nbl_device=/sys/class/backlight/intel_backlight/brightness\necho $(($(cat $bl_device)+200)) >$bl_device\n")),"\n",a.createElement(n.p,null,"Для уменьшения яркости:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-bash"},"# /etc/acpi/actions/bl_down.sh:\n\n#!/bin/sh\nbl_device=/sys/class/backlight/intel_backlight/brightness\necho $(($(cat $bl_device)-200)) >$bl_device\n")),"\n",a.createElement(n.p,null,"В ",a.createElement(n.code,null,"bl_device")," замените ",a.createElement(n.code,null,"inel_backlight")," на своё значение в\nзависимости от используемой видеокарты. Также стоит выяснить\nустраивающее вас значение, на основе которого будет увеличиваться или уменьшаться\nяркость экрана. У автора это значение = 200."),"\n",a.createElement(n.p,null,"Как найти подходящее значение?\nПосмотрите какая цифра стоит сейчас. Если вы ничего ещё не настраивали, она должна отражать максимально допустимое значение:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-shell"},"# cat  /sys/class/backlight/intel_backlight/brightness\n4882\n")),"\n",a.createElement(n.p,null,"Теперь поиграйте со значениями, чтобы выбрать нужный шаг:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-shell"},"# echo 1000 > /sys/class/backlight/intel_backlight/brightness\n# echo 1010 > /sys/class/backlight/intel_backlight/brightness\n# echo 1100 > /sys/class/backlight/intel_backlight/brightness\n")),"\n",a.createElement(n.p,null,"Посмотрите как будет изменяться яркость экрана при разных значениях, если при добавлении 10 единиц вы практически не чувствуете разницы, добавьте ещё 50-100 единиц. Какой шаг покажется оптимальным, тот и оставьте."),"\n",a.createElement(n.p,null,"Теперь укажем acpi использовать наши скрипты:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-bash"},"# /etc/acpi/events/bl_up\n#\nevent=video[ /]brightnessup\naction=/etc/acpi/actions/bl_up.sh\n\n# /etc/acpi/events/bl_down\n#\nevent=video[ /]brightnessdown\naction=/etc/acpi/actions/bl_down.sh\n")),"\n",a.createElement(n.p,null,"и сделаем эти скрипты исполняемыми:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-shell"},"# chmod +x /etc/acpi/actions/{bl_up.sh,bl_down.sh}\n")),"\n",a.createElement(n.p,null,"Чтобы автоматически подбирать яркость при работе от аккумулятора или же сети, установим laptop-mode-tools:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-shell"},"# pacman -S laptop-mode-tools\n")),"\n",a.createElement(n.p,null,"и немного изменим его настройки:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-bash"},'# /etc/laptop-mode/conf.d/lcd-brightness.conf\n#\nCONTROL_BRIGHTNESS=1\n# Commands to execute to set the brightness on your LCD\n#\n#BATT_BRIGHTNESS_COMMAND="echo [value]"\nBATT_BRIGHTNESS_COMMAND="echo 700"\nLM_AC_BRIGHTNESS_COMMAND="echo 2000"\nNOLM_AC_BRIGHTNESS_COMMAND="echo 3000"\nBRIGHTNESS_OUTPUT="/sys/class/backlight/intel_backlight/brightness"\n')),"\n",a.createElement(n.p,null,"Разумеется, значения ",a.createElement(n.code,null,"700/2000/3000")," и путь ",a.createElement(n.code,null,"/sys/class/backlight/intel_backlight/brightness")," должны быть заменены на ваши значения."),"\n",a.createElement(n.h2,{id:"автогибернация-при-критическом-уровне-заряда-батареи",style:{position:"relative"}},a.createElement(n.a,{href:"#%D0%B0%D0%B2%D1%82%D0%BE%D0%B3%D0%B8%D0%B1%D0%B5%D1%80%D0%BD%D0%B0%D1%86%D0%B8%D1%8F-%D0%BF%D1%80%D0%B8-%D0%BA%D1%80%D0%B8%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%BC-%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D0%B5-%D0%B7%D0%B0%D1%80%D1%8F%D0%B4%D0%B0-%D0%B1%D0%B0%D1%82%D0%B0%D1%80%D0%B5%D0%B8","aria-label":"автогибернация при критическом уровне заряда батареи permalink",className:"anchor before"},a.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Автогибернация при критическом уровне заряда батареи"),"\n",a.createElement(n.p,null,"Достаточно часто бывает такое, что при работе от батареи забываешь посматривать на уровень её заряда, в результате чего получаешь отключение машины при полной разрядке батареи. Внезапное - как хлопок - выключение и все несохранённые данные потеряны. Обидно, не правда ли? Поэтому неплохо было бы позаботиться о своевременных мерах предосторожности."),"\n",a.createElement(n.p,null,"Для этих целей также будем использовать функционал laptop-mode."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-bash"},'# /etc/laptop-mode/conf.d/auto-hibernate.conf:\n#\nENABLE_AUTO_HIBERNATION=1\n#\n# The hibernation command that is to be executed when auto-hibernation\n# is triggered.\n#\nHIBERNATE_COMMAND=/usr/share/laptop-mode-tools/module-helpers/pm-hibernate\n#\n# Auto-hibernation battery level threshold, in percentage of the battery\'s\n# total capacity.\n#\nAUTO_HIBERNATION_BATTERY_CHARGE_PERCENT=4\n#\n# Enable this to auto-hibernate if the battery reports that its level is\n# "critical".\n#\nAUTO_HIBERNATION_ON_CRITICAL_BATTERY_LEVEL=1\n')),"\n",a.createElement(n.p,null,"Если вас не устраивают значения по умолчанию, вы также можете изменить их.\nВ случае, если до этого момента у вас не был указан раздел swap, укажите его в grub2, эти настройки уже были даны выше:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-bash"},'# /etc/default/grub\n#\nGRUB_CMDLINE_LINUX_DEFAULT="acpi_backlight=vendor resume=/dev/sda5"\n')),"\n",a.createElement(n.p,null,"где ",a.createElement(n.code,null,"/dev/sda5")," - ваш swap-раздел\nКроме того, в случае с archlinux следует добавить хук suspend в  ",a.createElement(n.code,null,"/etc/mkinitcpio.conf"),":"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-bash"},'HOOKS="base udev autodetect modconf block filesystems usbinput fsck resume"\n')),"\n",a.createElement(n.p,null,"и пересобрать initrd:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-shell"},"# mkinitcpio -p linux\n")),"\n",a.createElement(n.h2,{id:"регулировка-звука",style:{position:"relative"}},a.createElement(n.a,{href:"#%D1%80%D0%B5%D0%B3%D1%83%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B0-%D0%B7%D0%B2%D1%83%D0%BA%D0%B0","aria-label":"регулировка звука permalink",className:"anchor before"},a.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Регулировка звука"),"\n",a.createElement(n.p,null,"Для этого снова обратимся к скриптам acpi, как и в случае с управлением яркостью дисплея."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-bash"},"# /etc/acpi/actions/volume_up.sh\n#\n#!/bin/bash\n/usr/bin/amixer set Master 5%+\n\n# /etc/acpi/actions/volume_down.sh\n#\n#!/bin/bash\n/usr/bin/amixer set Master 5%-\n\n# /etc/acpi/events/volume_up\n#\nevent=button[ /]volumeup\naction=/etc/acpi/actions/volume_up.sh\n\n# /etc/acpi/events/volume_down\n#\nevent=button[ /]volumedown\naction=/etc/acpi/actions/volume_down.sh\n")),"\n",a.createElement(n.p,null,"Делаем скрипты в actions исполняемыми:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-shell"},"# chmod +x /etc/acpi/actions/{volume_up.sh,volume_down.sh}\n")),"\n",a.createElement(n.p,null,"Для корректного распознавания мультимедийных клавиш, лучше использовать утилиту ",a.createElement(n.code,null,"xmodmap"),"."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-bash"},"$ xmodmap -pke > ~/.xmodmap\n$ vim .xinitrc:\nxmodmap ~/.xmodmap\n")),"\n",a.createElement(n.h2,{id:"acpi-и-события-клавиш",style:{position:"relative"}},a.createElement(n.a,{href:"#acpi-%D0%B8-%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D1%8F-%D0%BA%D0%BB%D0%B0%D0%B2%D0%B8%D1%88","aria-label":"acpi и события клавиш permalink",className:"anchor before"},a.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Acpi и события клавиш"),"\n",a.createElement(n.p,null,"Честно говоря, меня устраивает поведение по-умолчанию, поэтому с пристрастием\nэтот вопрос не рассматривался. При закрытии крышки ноутбука машина переходит\nв режим гибернации. При нажатии кнопки питания - корректно отключает систему. Оно и хорошо."),"\n",a.createElement(n.p,null,"Похоже, управление этими событиями тоже берёт на себя laptop-mode-tools\n( только пока неясно, в каком модуле/скрипте лежат эти настройки),\nпоскольку в ",a.createElement(n.code,null,"/etc/acpi/handler.sh")," каких-либо действий на события не назначено."),"\n",a.createElement(n.p,null,"Но таки рассмотрим как настраивать то или иное событие."),"\n",a.createElement(n.p,null,"Ответственен за эти шаманские действа вышеупомянутый ",a.createElement(n.code,null,"handler.sh"),"\n(или ",a.createElement(n.code,null,"default.sh")," в зависимости от используемого дистрибутива), где и прописываются\nнастройки. В случае, если вам хочется использовать не команду, а скрипт, расположите\nего в отдельном файле, подобно тому, как выше настраивалось управление яркостью\nдисплея и уровнем громкости ."),"\n",a.createElement(n.p,null,"Пример из дефолта:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-bash"},"button/lid)\n  case \"$3\" in\n    close)\n      logger 'LID closed'\n      ;;\n    open)\n      logger 'LID opened'\n      ;;\n    *)\n      logger \"ACPI action undefined: $3\"\n      ;;\n  esac\n  ;;\n")),"\n",a.createElement(n.p,null,a.createElement(n.code,null,"button/lid")," указывает на управление закрытием/открытием крышки ноутбука,\nпока здесь нет ничего интересного."),"\n",a.createElement(n.p,null,"Пример с воспроизведением звукового файла при закрытии/открытии крышки ноутбука:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-bash"},"button/lid)\n  case \"$3\" in\n    close)\n      logger 'LID closed'\n      aplay /home/redvi/.scripts/message.wav\n      ;;\n    open)\n      logger 'LID opened'\n      aplay /home/redvi/.scripts/message.wav\n      ;;\n    *)\n      logger \"ACPI action undefined: $3\"\n      ;;\n  esac\n  ;;\n")),"\n",a.createElement(n.p,null,"То есть для настройки события нужно добавить его команду в соответствующее\nполе ( здесь после ",a.createElement(n.code,null,"logger 'LID closed'"),"). Так, действие при открытии крышки\nнужно будет вписать после ",a.createElement(n.code,null,"logger 'LID opened'"),"."),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,a.createElement(n.code,null,"button/power")," — события, связанные с кнопкой управления питанием"),"\n",a.createElement(n.li,null,a.createElement(n.code,null,"logger 'PowerButton pressed'")," — когда клавиша нажата"),"\n",a.createElement(n.li,null,a.createElement(n.code,null,"button/sleep")," — сон, если подобная кнопка/клавиша имеется"),"\n",a.createElement(n.li,null,a.createElement(n.code,null,"ac_adapter")," — события, связанные с подключением/отключением адаптера питания"),"\n",a.createElement(n.li,null,a.createElement(n.code,null,"logger 'AC unpluged'")," — когда адаптер отключен"),"\n",a.createElement(n.li,null,a.createElement(n.code,null,"logger 'AC pluged'")," — когда адаптер подключен"),"\n",a.createElement(n.li,null,a.createElement(n.code,null,"battery")," — батарея ноутбука"),"\n",a.createElement(n.li,null,a.createElement(n.code,null,"button/lid")," — крышка ноутбука"),"\n"),"\n",a.createElement(n.p,null,"Для перевода в ждущий/спящий режимы можно использовать скрипты\n",a.createElement(n.code,null,"laptop-mode-tools")," из ",a.createElement(n.code,null,"/usr/share/laptop-mode-tools/module-helpers"),":  ",a.createElement(n.code,null,"pm-hibernate")," и  ",a.createElement(n.code,null,"pm-suspend"),"."),"\n",a.createElement(n.p,null,"Для выключения питания при закрытии крышки достаточно добавить\nв ",a.createElement(n.code,null,"/etc/acpi/actions/lm_lid.sh")," строку:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-bash"},'[ "$3" = "close" ] && poweroff\n')),"\n",a.createElement(n.p,null,"Помимо всего вышеописанного мы можем контролировать парковку головок жёсткого диска.\nДабы отключить парковку совсем пропишите в ",a.createElement(n.code,null,"/etc/laptop-mode/laptop-mode.conf"),":"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-bash"},"BATT_HD_POWERMGMT=254\nLM_AC_HD_POWERMGMT=254\nNOLM_AC_HD_POWERMGMT=254\n")),"\n",a.createElement(n.p,null,"Пожалуй, на этом стоит остановиться и дать читателю возможность самостоятельно\nпоэкспериментировать с настройками энергосбережения и событий acpi."))}var r=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,t.MN)(),e.components);return n?a.createElement(n,e,a.createElement(c,e)):c(e)},o=l(7792),s=l(7619);function m(e){var n,l;let{data:{mdx:t},children:c,pageContext:{prev:r,next:m}}=e;const{h1:i,title:u,description:p,image:d,table_of_contents:h}=t.frontmatter;return(0,a.useEffect)((()=>{(0,s.K)()}),[]),a.createElement(a.Fragment,null,a.createElement(o._W,{h1:i,title:u,description:p,image:null===(n=t.frontmatter.image)||void 0===n?void 0:n.publicURL},a.createElement(o.MV,{post:t.frontmatter,imageData:null==d||null===(l=d.childImageSharp)||void 0===l?void 0:l.gatsbyImageData},h?a.createElement(o.G8,{headings:t.tableOfContents}):null,a.createElement("div",{className:"page__content"},c,a.createElement(o.Mf,{prev:r,next:m})),a.createElement(o.QZ,null))))}function i(e){return a.createElement(m,e,a.createElement(r,e))}},8876:function(e,n,l){l.d(n,{MN:function(){return c}});var t=l(4424);const a=t.createContext({});function c(e){const n=t.useContext(a);return t.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}}}]);