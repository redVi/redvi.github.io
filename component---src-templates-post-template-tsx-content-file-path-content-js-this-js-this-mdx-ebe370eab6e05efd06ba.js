"use strict";(self.webpackChunkgatsby_blog=self.webpackChunkgatsby_blog||[]).push([[9896],{312:function(e,n,t){t.r(n),t.d(n,{Head:function(){return o.Ss},default:function(){return m}});var l=t(8876),a=t(4424);function r(e){const n=Object.assign({p:"p",em:"em",pre:"pre",code:"code",h2:"h2",a:"a",span:"span",strong:"strong",h3:"h3",ul:"ul",li:"li"},(0,l.MN)(),e.components);return a.createElement(a.Fragment,null,a.createElement(n.p,null,"В языке JavaScript есть такая вещь как this. Часто взаимодействие с ним вызывает\nтрудности у начинающих разработчиков. Надеюсь, после прочтения этой заметки вам\nникогда больше не придётся сталкиваться с неожиданным поведением ваших функций.\nЗдесь рассматривается сущность this и управление его поведением в часто\nвстречающихся сценариях."),"\n",a.createElement(n.p,null,"Мы используем this так же, как местоимение в языках подобных английскому или русскому.\nНе всегда называем имя или предмет, а говорим применительно к нему «этот».\nТо же самое происходит при использовании ключевого слова this в языках программирования.\nThis всегда является ссылкой на свойство объекта, но ",a.createElement(n.em,null,"что это за объект")," зависит\nот контекста."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},'var Person = {\n  firstName: "Jack",\n  lastName:  "Sparrow",\n\n  fullName: function() {\n    // this означает "этот"\n    return this.firstName + \' \' + this.lastName;\n    // аналогично такой записи:\n    return Person.firstName + \' \' + Person.lastName;\n  }\n};\n\nconsole.log(Person.fullName());\n//-> Jack Sparrow\n')),"\n",a.createElement(n.h2,{id:"почему-this",style:{position:"relative"}},a.createElement(n.a,{href:"#%D0%BF%D0%BE%D1%87%D0%B5%D0%BC%D1%83-this","aria-label":"почему this permalink",className:"anchor before"},a.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"почему this"),"\n",a.createElement(n.p,null,"Если вместо this обращаться к объекту через его имя (Person), мы рискуем вызвать\nметод совсем не того объекта. Ведь код может быть написан не одним человеком.\nВы уверены, что в скриптах, которые писали не вы, не будет глобальной переменной\nс таким же именем?"),"\n",a.createElement(n.p,null,"Объекты, как и функции, имеют свойства. Когда функция выполняется, она получает\nсвойство this того объекта, который её вызвал. This обычно используется внутри\nфункции, но при вызове в глобальной области видимости его значение будет\nзависеть от окружения. Например, для браузера глобальным объектом будет window,\nи код ",a.createElement(n.code,null,"console.log(this.innerHeight);")," вернёт высоту окна."),"\n",a.createElement(n.p,null,"При использовании ",a.createElement(n.strong,null,"строгого режима")," (strict mode) это не сработает: this не\nбудет связан с глобальным объектом и код вызовет ошибку. Такое же поведение\nожидаемо с анонимными функциями, ведь они не привязаны к конкретному объекту."),"\n",a.createElement(n.p,null,"Небольшой пример того, как работает this с jQuery:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},"$('button').click(function(event) {\n  // $(this) указывает на $('button') потому что объект $('button')\n  // запускает метод click, в котором определён this\n  console.log( $(this).prop('name') );\n});\n")),"\n",a.createElement(n.h2,{id:"когда-что-то-может-пойти-не-так",style:{position:"relative"}},a.createElement(n.a,{href:"#%D0%BA%D0%BE%D0%B3%D0%B4%D0%B0-%D1%87%D1%82%D0%BE-%D1%82%D0%BE-%D0%BC%D0%BE%D0%B6%D0%B5%D1%82-%D0%BF%D0%BE%D0%B9%D1%82%D0%B8-%D0%BD%D0%B5-%D1%82%D0%B0%D0%BA","aria-label":"когда что то может пойти не так permalink",className:"anchor before"},a.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Когда что-то может пойти не так"),"\n",a.createElement(n.p,null,"Кажется, что всё просто как дважды два. Тогда почему this вызывает столько\nвопросов и ведёт себя не так, как мы ожидаем?"),"\n",a.createElement(n.h3,{id:"метод-как-функция-обратного-вызова",style:{position:"relative"}},a.createElement(n.a,{href:"#%D0%BC%D0%B5%D1%82%D0%BE%D0%B4-%D0%BA%D0%B0%D0%BA-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-%D0%BE%D0%B1%D1%80%D0%B0%D1%82%D0%BD%D0%BE%D0%B3%D0%BE-%D0%B2%D1%8B%D0%B7%D0%BE%D0%B2%D0%B0","aria-label":"метод как функция обратного вызова permalink",className:"anchor before"},a.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Метод как функция обратного вызова"),"\n",a.createElement(n.p,null,"Объект ",a.createElement(n.code,null,"Boxer")," содержит некие данные и метод ",a.createElement(n.code,null,"clickHandler"),". Мы ищем объект-DOM\nс классом ",a.createElement(n.code,null,".boxer"),". Добавляем обработчик события и в качестве функции пытаемся\nпередать ему ",a.createElement(n.code,null,"clickHandler"),", который будет рандомно отображать в консоли имя\nодного из боксёров."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},"var Boxer = {\n  data: [\n    { name: 'M.Tyson', age: 49},\n    { name: 'M.Ali', age: 74}\n  ],\n  clickHandler: function() {\n    var randomNum = Math.random() * 2|0;\n    console.log(this.data[randomNum].name + ' ' + this.data[randomNum].age);\n  }\n};\n\ndocument.querySelector('.boxer').addEventListener('click', Boxer.clickHandler);\n// -> Cannot read property '1' of undefined\n")),"\n",a.createElement(n.p,null,"Ничего не вышло. Всё дело в том, что функцию в данном контексте вызывает\nDOM-объект ",a.createElement(n.code,null,".boxer"),". Наш ",a.createElement(n.code,null,"Boxer.clickHandler")," пытается быть выполненным в контексте\n",a.createElement(n.code,null,".boxer"),"."),"\n",a.createElement(n.p,null,a.createElement(n.strong,null,"Решение:")," явно привязать функцию обратного вызова к объекту через метод ",a.createElement(n.code,null,"bind()"),"."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},"// передаём нужный объект методу bind()\ndocument.querySelector('.boxer').\n  addEventListener('click', Boxer.clickHandler.bind(Boxer));\n")),"\n",a.createElement(n.p,null,"Теперь всё в порядке."),"\n",a.createElement(n.h3,{id:"this-внутри-замыкания",style:{position:"relative"}},a.createElement(n.a,{href:"#this-%D0%B2%D0%BD%D1%83%D1%82%D1%80%D0%B8-%D0%B7%D0%B0%D0%BC%D1%8B%D0%BA%D0%B0%D0%BD%D0%B8%D1%8F","aria-label":"this внутри замыкания permalink",className:"anchor before"},a.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"this внутри замыкания"),"\n",a.createElement(n.p,null,"Другой случай, когда поведение this может поставить в тупик: если он находится\nвнутри замыкания. Тогда мы не можем получить доступ к this внешней функции.\nПерепишем код примера выше так, чтобы он удовлетворял новому условию."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},"var Boxer = {\n  'type of sport': 'boxing',\n  data: [\n    { name: 'M.Tyson', age: 49 },\n    { name: 'M.Ali', age: 74 }\n  ],\n\n  clickHandler: function() {\n    // ссылается на Boxer\n    this.data.forEach(function(person) {\n      // теперь мы внутри data\n      console.log(person.name +\n        '. His type of sport ' +  this['type of sport']);\n    });\n  }\n};\n\nBoxer.clickHandler();\n//-> M.Tyson. His type of sport undefined\n")),"\n",a.createElement(n.p,null,"Раз this из замыкания не имеет доступа к this внешних функций, он будет привязан\nк глобальному объекту (если не включен строгий режим)."),"\n",a.createElement(n.p,null,a.createElement(n.strong,null,"Решение:")," передать значение this другой переменной перед тем как создать\nзамыкание. Такую переменную принято называть that."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},"clickHandler: function() {\n  // передаём значение текущего this\n  var that = this;\n\n  this.data.forEach(function(person) {\n    console.log(person.name +\n      '. His type of sport ' + that['type of sport']);\n    console.log(that.data[0]['age']);\n  });\n}\n\n// M.Tyson. His type of sport boxing\n// 49\n")),"\n",a.createElement(n.p,null,"Хорошие новости. В ES6 делать этого не нужно. Спокойно пользуйтесь стрелочными\nфункциями, они не имеют своего this и просто берут тот, что снаружи."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},"var Boxer = {\n  'type of sport': 'boxing',\n  data: [\n    { name: 'M.Tyson', age: 49 },\n    { name: 'M.Ali', age: 74 },\n  ],\n\n  clickHandler() {\n    this.data.forEach(person => console.log(\n      `${person.name}. His sport ${this['type of sport']}`)\n    );\n  },\n};\n\nBoxer.clickHandler();\n")),"\n",a.createElement(n.h3,{id:"метод-объекта-передан-в-переменную",style:{position:"relative"}},a.createElement(n.a,{href:"#%D0%BC%D0%B5%D1%82%D0%BE%D0%B4-%D0%BE%D0%B1%D1%8A%D0%B5%D0%BA%D1%82%D0%B0-%D0%BF%D0%B5%D1%80%D0%B5%D0%B4%D0%B0%D0%BD-%D0%B2-%D0%BF%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%83%D1%8E","aria-label":"метод объекта передан в переменную permalink",className:"anchor before"},a.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"метод объекта передан в переменную"),"\n",a.createElement(n.p,null,"Вернёмся к нашим боксёрам. Добавим пару чемпионов."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},"var data = [\n  { name: 'Joe Louis' },\n  { name: 'Lennox Lewis' }\n];\n\nvar Boxer = {\n  data: [\n    { name: 'Mike Tyson', age: 49 },\n    { name: 'Muhammad Ali', age: 74 }\n  ],\n  clickHandler: function() {\n    console.log (this.data[0].name);\n  }\n};\n\nvar showBoxer = Boxer.clickHandler;\n\nconsole.log(data[0].name); //-> Joe Louis\nconsole.log(showBoxer()); //-> Joe Louis\n")),"\n",a.createElement(n.p,null,"Вызов ",a.createElement(n.code,null,"data")," из глобальной области видимости и вызов ",a.createElement(n.code,null,"showBoxer")," оказался\nодинаковым. Когда ",a.createElement(n.code,null,"showBoxer")," срабатывает, вызывается анонимная функция:"),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},"function() {\n  console.log (this.data[0].name);\n}\n")),"\n",a.createElement(n.p,null,"Всё верно, этот кусок кода был «заморожен» в ",a.createElement(n.code,null,"clickHandler"),". Однако,\nсейчас он выполнился в контексте глобального объекта."),"\n",a.createElement(n.p,null,a.createElement(n.strong,null,"Решение:")," снова явно привязать метод к объекту."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},"var showBoxer = Boxer.clickHandler.bind(Boxer);\nconsole.log(showBoxer());\n//-> Mike Tyson\n")),"\n",a.createElement(n.h3,{id:"заимствованные-методы",style:{position:"relative"}},a.createElement(n.a,{href:"#%D0%B7%D0%B0%D0%B8%D0%BC%D1%81%D1%82%D0%B2%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5-%D0%BC%D0%B5%D1%82%D0%BE%D0%B4%D1%8B","aria-label":"заимствованные методы permalink",className:"anchor before"},a.createElement(n.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"заимствованные методы"),"\n",a.createElement(n.p,null,"Четвёртый и последний случай: имеем два объекта, у одного из них хотим вызвать\nметод другого. Допустим, рассчитать среднее количество очков на раунд игры."),"\n",a.createElement(n.p,null,"Ниже используется метод ",a.createElement(n.code,null,"reduce"),". Он принимает значения:"),"\n",a.createElement(n.ul,null,"\n",a.createElement(n.li,null,"последний (он же промежуточный) результат (prev)"),"\n",a.createElement(n.li,null,"текущий элемент массива (cur)"),"\n",a.createElement(n.li,null,"номер текущего элемента (index)"),"\n",a.createElement(n.li,null,"передаваемый массив (array)"),"\n"),"\n",a.createElement(n.p,null,"В ",a.createElement(n.code,null,"getTotal")," передаём переменной сумму всех очков, затем делим их на количество\nраундов."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},"// первая игра\nvar angryBirds = {\n  // количество очков, 4 раунда\n  scores:   [10, 5, 15, 30],\n  // среднее значение ещё не рассчитано\n  average: null\n};\n\n// вторая игра\nvar angryCats = {\n  // количество очков, 5 раундов\n  scores:   [25, 32, 16, 43, 56],\n  average: null,\n\n  getTotal: function () {\n    var sumOfScores = this.scores.reduce(function (prev, cur, index, array) {\n      return prev + cur;\n    });\n    this.average = sumOfScores / this.scores.length;\n  }\n};\n\nangryBirds.average = angryCats.getTotal();\nconsole.log(angryBirds.average);\n")),"\n",a.createElement(n.p,null,"Но такой фокус не пройдёт. Метод ",a.createElement(n.code,null,"getTotal")," вызвается объектом angryCats."),"\n",a.createElement(n.p,null,a.createElement(n.strong,null,"Решение:")," ",a.createElement(n.code,null,"apply")," позволяет вызывать метод одного объекта в контексте другого."),"\n",a.createElement(n.pre,null,a.createElement(n.code,{className:"language-js"},"angryCats.getTotal.apply(angryBirds, angryBirds.scores);\nconsole.log(angryBirds.average);\n")),"\n",a.createElement(n.p,null,"Объект angryBirds «одолжил» метод ",a.createElement(n.code,null,"getTotal")," у angryCats. This передана\nangryBirds, потому что он указан первым параметром метода ",a.createElement(n.code,null,"apply"),"."))}var c=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,l.MN)(),e.components);return n?a.createElement(n,e,a.createElement(r,e)):r(e)},o=t(7792),s=t(7619);function i(e){var n,t;let{data:{mdx:l},children:r,pageContext:{prev:c,next:i}}=e;const{h1:m,title:u,description:h,image:d,table_of_contents:D}=l.frontmatter;return(0,a.useEffect)((()=>{(0,s.K)()}),[]),a.createElement(a.Fragment,null,a.createElement(o._W,{h1:m,title:u,description:h,image:null===(n=l.frontmatter.image)||void 0===n?void 0:n.publicURL},a.createElement(o.MV,{post:l.frontmatter,imageData:null==d||null===(t=d.childImageSharp)||void 0===t?void 0:t.gatsbyImageData},D?a.createElement(o.G8,{headings:l.tableOfContents}):null,a.createElement("div",{className:"page__content"},r,a.createElement(o.Mf,{prev:c,next:i})),a.createElement(o.QZ,null))))}function m(e){return a.createElement(i,e,a.createElement(c,e))}},8876:function(e,n,t){t.d(n,{MN:function(){return r}});var l=t(4424);const a=l.createContext({});function r(e){const n=l.useContext(a);return l.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}}}]);