"use strict";(self.webpackChunkgatsby_blog=self.webpackChunkgatsby_blog||[]).push([[3748],{3884:function(n,a,s){s.r(a),s.d(a,{Head:function(){return o.Ss},default:function(){return u}});var t=s(8876),e=s(4424);function p(n){const a=Object.assign({p:"p",h2:"h2",a:"a",span:"span",em:"em",blockquote:"blockquote",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",strong:"strong",h3:"h3",ul:"ul",li:"li"},(0,t.MN)(),n.components);return e.createElement(e.Fragment,null,e.createElement(a.p,null,"В продолжение темы о публикациях, способах их создания и размещения. На этот раз\nпопробуем приготовить основу блога, базирующегося на sinatra."),"\n",e.createElement(a.h2,{id:"введение",style:{position:"relative"}},e.createElement(a.a,{href:"#%D0%B2%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5","aria-label":"введение permalink",className:"anchor before"},e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Введение"),"\n",e.createElement(a.p,null,e.createElement(a.em,null,"Sinatra")," — DSL (Domain Specific language, предметно-специфичный язык),\nиспользующий интерфейс для разработки веб приложений ",e.createElement(a.em,null,"Rack"),". Хотя в некоторых\nисточниках его гордо именуют веб-фреймворком, на официальном сайте можно\nвстретить следующую формулировку:"),"\n",e.createElement(a.blockquote,null,"\n",e.createElement(a.p,null,"Sinatra is a DSL for quickly creating web applications in Ruby with minimal\neffort"),"\n",e.createElement(a.p,null,"Sinatra это DSL для быстрого создания веб-приложений на Ruby с минимальными усилиями"),"\n"),"\n",e.createElement(a.p,null,"В природе имеются и полноценные фреймворки, базирующиеся на sinatra. Padrino, например."),"\n",e.createElement(a.p,null,"Увы, об истории создания самого Sinatra миру неизвестно ничего, кроме того факта, что\nразработал его некий Blake Mizerany из солнечного штата Калифорния."),"\n",e.createElement(a.h2,{id:"первые-шаги",style:{position:"relative"}},e.createElement(a.a,{href:"#%D0%BF%D0%B5%D1%80%D0%B2%D1%8B%D0%B5-%D1%88%D0%B0%D0%B3%D0%B8","aria-label":"первые шаги permalink",className:"anchor before"},e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Первые шаги"),"\n",e.createElement(a.p,null,"Для начала установим необходимый минимум зависимостей и поприветствуем мир. Для\nсего несложного действа нам потребуется создать несколько файлов. Вот они:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ <span class="token function">mkdir</span> sinatra <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> sinatra\n$ <span class="token function">touch</span> main.rb config.ru Gemfile</code></pre></div>'}}),"\n",e.createElement(a.p,null,"При помощи ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">main.rb</code>'}})," мы будем взывать к самому sinatra, ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">config.ru</code>'}})," понадобится\nнам для запуска нашего минималистичного веб-сервера, а в ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">Gemfile</code>'}})," будут\nсосредоточены те джемы, которые потребуются для запуска всего этого хозяйства."),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># main.rb</span>\n\n<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">\'sinatra\'</span></span> <span class="token comment"># подгрузить sinatra</span>\n<span class="token comment"># sinatra имеет модульную структуру</span>\n<span class="token comment"># что позволяет включать лишь необходимое:</span>\n<span class="token comment"># require \'sinatra/base\'</span>\n<span class="token comment"># вывести на главной странице приветствие</span>\nget <span class="token string-literal"><span class="token string">\'/\'</span></span> <span class="token keyword">do</span>\n  <span class="token string-literal"><span class="token string">"&lt;h2>Hello!&lt;/h2>"</span></span>\n<span class="token keyword">end</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Дальше заглянем в файл с нашими джемами:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># Gemfile</span>\n\nsource <span class="token string-literal"><span class="token string">\'https://rubygems.org\'</span></span> <span class="token comment"># откуда брать gem\'ы</span>\nruby <span class="token string-literal"><span class="token string">\'2.1.0\'</span></span> <span class="token comment"># версия руби</span>\n\ngem <span class="token string-literal"><span class="token string">\'sinatra\'</span></span>\ngem <span class="token string-literal"><span class="token string">\'rake\'</span></span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Можно установить эти джемы вручную или же при помощи ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">bundle</code>'}}),", ежели таковой у\nвас уже имеется:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ gem <span class="token function">install</span> my_gem <span class="token comment"># ручная установка джемов</span>\n$ bundle <span class="token function">install</span> <span class="token comment"># рекомендуемый способ, bundle будет читать ваш Gemfile</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Чтобы при установке пакетов не ставить документацию к ним можно создать в домашнем каталоге файл ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">~/.gemrc</code>'}})," с таким содержанием:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># ~/.gemrc</span>\ngem: --no-rdoc --no-ri</code></pre></div>'}}),"\n",e.createElement(a.p,null,"Осталось главное: запустить наше приветствие. Сделаем это, обратившись к\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">config.ru</code>'}}),":"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment">#\\ -w -p 4000 # указать желаемый порт</span>\n\n<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">\'./main.rb\'</span></span> <span class="token comment"># подгрузить main.rb</span>\nrun Sinatra<span class="token double-colon punctuation">::</span>Application <span class="token comment"># запустить приложение</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Отныне по адресу ",e.createElement(a.a,{href:"http://localhost:4000",target:"_blank",rel:"nofollow"},"http://localhost:4000")," доступна наша первая страничка. Введите\nв консоли команду ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">rackup</code>'}}),", чтобы запустить сервер разработки WEBrick и\nубедиться в этом."),"\n",e.createElement(a.h2,{id:"миграции",style:{position:"relative"}},e.createElement(a.a,{href:"#%D0%BC%D0%B8%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D0%B8","aria-label":"миграции permalink",className:"anchor before"},e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Миграции"),"\n",e.createElement(a.p,null,"Для удобства вынесем некоторые элементы из корня в другие каталоги, после чего\nструктура приложения будет выглядеть следующим образом:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">sinatra\n├── app\n│   ├── helpers.rb\n│   ├── models.rb\n│   └── routes.rb\n├── config\n│   ├── constants.rb\n│   └── environments.rb\n├── config.ru\n├── Gemfile\n├── main.rb\n├── public\n│   ├── favicon.ico\n│   ├── images\n│   │   ├── logo.png\n│   └── style.css\n├── Rakefile\n└── views\n    ├── index.erb\n    └── layout.erb</code></pre></div>'}}),"\n",e.createElement(a.p,null,"Подключим наши новообразованные файлы:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># main.rb</span>\n<span class="token comment"># -*- coding: utf-8 -*-</span>\n\n<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">\'sinatra\'</span></span>\n<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">\'sinatra/activerecord\'</span></span>\n<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">\'redcarpet\'</span></span>\n\n<span class="token variable">$LOAD_PATH</span><span class="token punctuation">.</span>unshift<span class="token punctuation">(</span><span class="token builtin">File</span><span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__FILE__<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string-literal"><span class="token string">\'/app\'</span></span><span class="token punctuation">)</span>\n<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">\'models\'</span></span>  <span class="token comment"># здесь живут модели</span>\n<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">\'routes\'</span></span>  <span class="token comment"># маршруты</span>\n<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">\'helpers\'</span></span> <span class="token comment"># и хелперы</span>\n\n<span class="token variable">$LOAD_PATH</span><span class="token punctuation">.</span>unshift<span class="token punctuation">(</span><span class="token builtin">File</span><span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__FILE__<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string-literal"><span class="token string">\'/config\'</span></span><span class="token punctuation">)</span>\n<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">\'environments\'</span></span> <span class="token comment"># настройки конфигурации</span>\n<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">\'constants\'</span></span>    <span class="token comment"># константы</span>\n\n<span class="token comment"># или короче</span>\n<span class="token comment"># Dir.glob(\'./{app,config}/*.rb\').each {|file| require file}</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Теперь все пути станем прописывать в файле ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">routes.rb</code>'}})),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># -*- coding: utf-8 -*-</span>\n<span class="token comment"># app/routes.rb</span>\n\nget <span class="token string-literal"><span class="token string">\'/\'</span></span> <span class="token keyword">do</span>\n  <span class="token variable">@title</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">\'Заголовок индексной страницы\'</span></span>\n  erb <span class="token symbol">:index</span>\n<span class="token keyword">end</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"В отдельном файле хранятся такие вещи как заголовок и url сайта:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># config/constants.rb</span>\n<span class="token comment"># -*- coding: utf-8 -*-</span>\n\n<span class="token constant">SITE_NAME</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">\'Mysite\'</span></span>\n<span class="token constant">SITE_URL</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">\'http://0.0.0.0:4000\'</span></span>\n<span class="token constant">SITE_SUBTITLE</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">\'IT Blog\'</span></span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Для того, чтобы убедиться в работоспособности приложения изменим\n«вьюху»:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="erb"><pre class="language-erb"><code class="language-erb"><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"><span class="token comment"># /views/layout.erb </span></span><span class="token delimiter punctuation">%></span></span>\n\n<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n\n  <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"> <span class="token keyword">if</span> <span class="token variable">@title</span>  </span><span class="token delimiter punctuation">%></span></span>\n    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"><span class="token comment"># /вывести заголовок страницы и имя сайта </span></span><span class="token delimiter punctuation">%></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> <span class="token variable">@title</span> <span class="token operator">+</span> <span class="token string-literal"><span class="token string">" | </span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content"><span class="token constant">SITE_NAME</span></span><span class="token delimiter punctuation">}</span></span><span class="token string">"</span></span> </span><span class="token delimiter punctuation">%></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"> <span class="token keyword">else</span> </span><span class="token delimiter punctuation">%></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"><span class="token string-literal"><span class="token string">"</span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content"><span class="token constant">SITE_NAME</span></span><span class="token delimiter punctuation">}</span></span><span class="token string">"</span></span> </span><span class="token delimiter punctuation">%></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"> <span class="token keyword">end</span> </span><span class="token delimiter punctuation">%></span></span>\n\n  <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"> <span class="token keyword">if</span> <span class="token variable">@summary</span> </span><span class="token delimiter punctuation">%></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>description<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> <span class="token variable">@summary</span> <span class="token operator">||</span> <span class="token variable">@post</span><span class="token punctuation">.</span>summary </span><span class="token delimiter punctuation">%></span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"> <span class="token keyword">end</span> </span><span class="token delimiter punctuation">%></span></span>\n\n  <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"><span class="token comment"># путь к иконке из public </span></span><span class="token delimiter punctuation">%></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>icon<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/favicon.ico<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image/x-icon<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>shortcut icon<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/favicon.ico<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image/x-icon<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n\n  <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"><span class="token comment"># путь к css из public </span></span><span class="token delimiter punctuation">%></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/style.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span><span class="token punctuation">></span></span>\n        <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> <span class="token keyword">yield</span> </span><span class="token delimiter punctuation">%></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Sinatra поддерживает встроенные шаблоны. Так, вы можете разбить\nглавный шаблон на более мелкие и подключать их отдельно:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="erb"><pre class="language-erb"><code class="language-erb"><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> erb <span class="token operator">:</span><span class="token string-literal"><span class="token string">\'includes/footer\'</span></span><span class="token punctuation">,</span> <span class="token symbol">:layout</span> <span class="token operator">=></span> <span class="token boolean">false</span> </span><span class="token delimiter punctuation">%></span></span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Как мы увидим впоследствии, при открытии страницы ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">index</code>'}})," заголовки должны\nизмениться на указанные нами."),"\n",e.createElement(a.p,null,"Но что же с моделью? Все наши записи мы будем хранить в базе данных,\nосуществлять же доступ к оной нам поможет\n",e.createElement(a.a,{href:"http://rusrails.ru/active-record-query-interface",target:"_blank",rel:"nofollow"},"ActiveRecord"),"."),"\n",e.createElement(a.p,null,"Для начала убедимся, что с базой данных не возникнет проблем. Изменим настройки\nнескольких файлов:"),"\n",e.createElement(a.p,null,"Установка связи с ActiveRecord:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># config/environments.rb</span>\n<span class="token comment"># настройки при разработке приложения</span>\n\nconfigure <span class="token symbol">:development</span> <span class="token keyword">do</span>\n set <span class="token symbol">:database</span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">\'sqlite3:///dev.db\'</span></span>\n set <span class="token symbol">:show_exceptions</span><span class="token punctuation">,</span> <span class="token boolean">true</span>\n<span class="token keyword">end</span>\n\n<span class="token comment"># настройки для production-окружения</span>\nconfigure <span class="token symbol">:production</span> <span class="token keyword">do</span>\n db <span class="token operator">=</span> <span class="token constant">URI</span><span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">\'DATABASE_URL\'</span></span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string-literal"><span class="token string">\'postgres:///localhost/mydb\'</span></span><span class="token punctuation">)</span>\n\n ActiveRecord<span class="token double-colon punctuation">::</span>Base<span class="token punctuation">.</span>establish_connection<span class="token punctuation">(</span>\n   <span class="token symbol">:adapter</span>  <span class="token operator">=></span> db<span class="token punctuation">.</span>scheme <span class="token operator">==</span> <span class="token string-literal"><span class="token string">\'postgres\'</span></span> <span class="token operator">?</span> <span class="token string-literal"><span class="token string">\'postgresql\'</span></span> <span class="token operator">:</span> db<span class="token punctuation">.</span>scheme<span class="token punctuation">,</span>\n   <span class="token symbol">:host</span>     <span class="token operator">=></span> db<span class="token punctuation">.</span>host<span class="token punctuation">,</span>\n   <span class="token symbol">:username</span> <span class="token operator">=></span> db<span class="token punctuation">.</span>user<span class="token punctuation">,</span>\n   <span class="token symbol">:password</span> <span class="token operator">=></span> db<span class="token punctuation">.</span>password<span class="token punctuation">,</span>\n   <span class="token symbol">:database</span> <span class="token operator">=></span> db<span class="token punctuation">.</span>path<span class="token punctuation">[</span><span class="token number">1.</span><span class="token punctuation">.</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n   <span class="token symbol">:encoding</span> <span class="token operator">=></span> <span class="token string-literal"><span class="token string">\'utf8\'</span></span>\n <span class="token punctuation">)</span>\n<span class="token keyword">end</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Таким образом в разных окружениях (development & production) будут\nиспользоваться разные базы данных. Также вносятся поправки в другие файлы:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># Rakefile</span>\n<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">\'./main\'</span></span>\n<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">\'sinatra/activerecord/rake\'</span></span>\n\n<span class="token comment"># app/models.rb</span>\n<span class="token keyword">class</span> <span class="token class-name">Post</span> <span class="token operator">&lt;</span> ActiveRecord<span class="token double-colon punctuation">::</span>Base\n<span class="token keyword">end</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Ниже приводится полное содержимое джемфайла."),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># -*- coding: utf-8 -*-</span>\n<span class="token comment"># Gemfile</span>\n\nsource <span class="token string-literal"><span class="token string">\'https://rubygems.org\'</span></span>\nruby <span class="token string-literal"><span class="token string">\'2.1.0\'</span></span>\n\ngem <span class="token string-literal"><span class="token string">\'sinatra\'</span></span>\ngem <span class="token string-literal"><span class="token string">\'redcarpet\'</span></span>\ngem <span class="token string-literal"><span class="token string">\'pygments.rb\'</span></span>\ngem <span class="token string-literal"><span class="token string">\'activerecord\'</span></span>\ngem <span class="token string-literal"><span class="token string">\'sinatra-activerecord\'</span></span>\n\ngroup <span class="token symbol">:development</span> <span class="token keyword">do</span>\n  gem <span class="token string-literal"><span class="token string">\'shotgun\'</span></span>\n  gem <span class="token string-literal"><span class="token string">\'tux\'</span></span>\n  gem <span class="token string-literal"><span class="token string">\'sqlite3\'</span></span>\n<span class="token keyword">end</span>\n\ngroup <span class="token symbol">:production</span> <span class="token keyword">do</span>\n  gem <span class="token string-literal"><span class="token string">\'pg\'</span></span>\n<span class="token keyword">end</span>\n\ngroup <span class="token symbol">:test</span> <span class="token keyword">do</span>\n  gem <span class="token string-literal"><span class="token string">\'rspec\'</span></span>\n<span class="token keyword">end</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Доустановить недостающие зависимости без установки джемов для production-окружения\nможно командой"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ bundle <span class="token function">install</span> <span class="token parameter variable">--without</span> production</code></pre></div>'}}),"\n",e.createElement(a.p,null,"Теперь создадим саму миграцию: если говорить просто, это такая штука, при помощи\nкоторой мы можем менять схему нашей БД. Сейчас нам важно, что миграции весьма\nудобны для тестового наполнения базы данных."),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ rake <span class="token parameter variable">-T</span> <span class="token punctuation">(</span>отобразить справку по возможным действиям<span class="token punctuation">)</span>\n$ rake db:create_migration <span class="token assign-left variable">NAME</span><span class="token operator">=</span>create_post <span class="token punctuation">(</span>создать миграцию<span class="token punctuation">)</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Если всё прошло успешно, в корневом каталоге проекта появится подкаталог ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">db</code>'}}),",\nсодержащий миграцию вида ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">db/migrate/xxx_create_post.rb</code>'}}),". Изменим её:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># db/migrate/xxx_create_post.rb</span>\n<span class="token comment"># -*- coding: utf-8 -*-</span>\n\n<span class="token keyword">class</span> <span class="token class-name">CreatePost</span> <span class="token operator">&lt;</span> ActiveRecord<span class="token double-colon punctuation">::</span>Migration\n  <span class="token keyword">def</span> <span class="token method-definition"><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">up</span></span>\n    <span class="token comment"># создание таблицы с заданными полями</span>\n    create_table <span class="token symbol">:posts</span> <span class="token keyword">do</span> <span class="token operator">|</span>post<span class="token operator">|</span>\n      post<span class="token punctuation">.</span>string   <span class="token symbol">:title</span>\n      post<span class="token punctuation">.</span>text     <span class="token symbol">:content</span>\n      post<span class="token punctuation">.</span>timestamps\n    <span class="token keyword">end</span>\n\n    <span class="token comment"># тестовые записи</span>\n    Post<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token symbol">title</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"Example Post"</span></span><span class="token punctuation">,</span>\n                <span class="token symbol">content</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"Content of my first post"</span></span><span class="token punctuation">)</span>\n    Post<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token symbol">title</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"Second Post"</span></span><span class="token punctuation">,</span>\n                <span class="token symbol">content</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"Content of my second post"</span></span><span class="token punctuation">)</span>\n  <span class="token keyword">end</span>\n  <span class="token keyword">def</span> <span class="token method-definition"><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">down</span></span>\n    <span class="token comment"># откатить миграцию (rake:db rollback)</span>\n    drop_table <span class="token symbol">:posts</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Осталось лишь запустить миграцию, после чего в каталоге ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">db</code>'}})," автоматически\nпоявится файл ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">schema.rb</code>'}}),":"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ rake db:migrate</code></pre></div>'}}),"\n",e.createElement(a.p,null,"А в корневом каталоге должен появиться файл ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">dev.db</code>'}}),", представляющий собой базу\nс созданной в ней (указанной в миграции) таблицей."),"\n",e.createElement(a.h2,{id:"играем-с-tuxом",style:{position:"relative"}},e.createElement(a.a,{href:"#%D0%B8%D0%B3%D1%80%D0%B0%D0%B5%D0%BC-%D1%81-tux%D0%BE%D0%BC","aria-label":"играем с tuxом permalink",className:"anchor before"},e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Играем с tux'ом"),"\n",e.createElement(a.p,null,"Внимательный читатель наверняка заметил, что мы установили несколько новых\nджемов: tux, shotgun. Второй из них теперь можно запускать вместо команды\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">rackup</code>'}})," — при внесении любых изменений вам не потребуется перезапускать\nсервер, shotgun сделает всю рутинную работу за вас."),"\n",e.createElement(a.p,null,"Первый из упомянутых джем окажет посильную помощь при разработке приложений на\nsinatra. Это консольная программа, являющаяся связующим звеном между\nразработчиком и sinatra-приложением. Давайте поиграем с ней."),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ tux\nLoading development environment <span class="token punctuation">(</span>Rack <span class="token number">1.2</span><span class="token punctuation">)</span>\n<span class="token operator">>></span> a <span class="token operator">=</span> Post.all <span class="token punctuation">(</span>получить все посты<span class="token punctuation">)</span>\n<span class="token punctuation">[</span>DEBUG -- <span class="token builtin class-name">:</span> Post Load <span class="token punctuation">(</span><span class="token number">2</span>.0ms<span class="token punctuation">)</span>  SELECT <span class="token string">"posts"</span>.* FROM <span class="token string">"posts"</span>\n<span class="token operator">=</span><span class="token operator">></span> <span class="token comment">#&lt;ActiveRecord::Relation</span>\n<span class="token punctuation">[</span><span class="token comment">#&lt;Post id: 1, title: "What is sinatra?"]></span>\n<span class="token punctuation">..</span>. вывод сокращён <span class="token punctuation">..</span>.\n<span class="token operator">>></span> a.count <span class="token punctuation">(</span>количество постов<span class="token punctuation">)</span>\nDEBUG -- <span class="token builtin class-name">:</span> <span class="token punctuation">(</span><span class="token number">0</span>.4ms<span class="token punctuation">)</span>  SELECT COUNT<span class="token punctuation">(</span>*<span class="token punctuation">)</span> FROM <span class="token string">"posts"</span>\n<span class="token operator">=</span><span class="token operator">></span> <span class="token number">4</span>\n<span class="token operator">>></span> a.first <span class="token punctuation">(</span>получить данные первого поста<span class="token punctuation">)</span>\n<span class="token operator">=</span><span class="token operator">></span> <span class="token comment">#&lt;Post id: 1, title: "What is sinatra?" content: "Sinatra is..."></span>\n<span class="token operator">>></span> a.first.title <span class="token punctuation">(</span>заголовок первого поста<span class="token punctuation">)</span>\n<span class="token operator">=</span><span class="token operator">></span> <span class="token string">"What is sinatra?"</span>\n<span class="token operator">>></span> a.first.id <span class="token punctuation">(</span>его идентификатор<span class="token punctuation">)</span>\n<span class="token operator">=</span><span class="token operator">></span> <span class="token number">1</span>\n<span class="token operator">>></span> a.last.content<span class="token punctuation">(</span>тело последнего поста<span class="token punctuation">)</span>\n<span class="token operator">=</span><span class="token operator">></span> <span class="token string">"Oh, my last post!"</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Надеюсь, читатель убедился в небесполезности tux'а: прежде, чем писать новую\nфункциональность можно немного потестировать её в консоли."),"\n",e.createElement(a.h2,{id:"crud",style:{position:"relative"}},e.createElement(a.a,{href:"#crud","aria-label":"crud permalink",className:"anchor before"},e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"CRUD"),"\n",e.createElement(a.p,null,"Дабы наконец развлечься каким-то практическим эффектом от содеянного\nранее, займёмся написанием маршрутов и шаблонов: нужно ведь отобразить ту\nинформацию, которую мы имеем. А заодно узнаем, что скрывается под аббревиатурой\nCRUD."),"\n",e.createElement(a.p,null,"CRUD — так именуются четыре базовые функции для работы с данными и Sinatra\nвполне поддерживает их все."),"\n",e.createElement(a.table,null,e.createElement(a.thead,null,e.createElement(a.tr,null,e.createElement(a.th,null,"сокращение"),e.createElement(a.th,null,"значение"),e.createElement(a.th,null,"sinatra"))),e.createElement(a.tbody,null,e.createElement(a.tr,null,e.createElement(a.td,null,e.createElement(a.strong,null,"C")),e.createElement(a.td,null,"create"),e.createElement(a.td,null,"put")),e.createElement(a.tr,null,e.createElement(a.td,null,e.createElement(a.strong,null,"R")),e.createElement(a.td,null,"read"),e.createElement(a.td,null,"get")),e.createElement(a.tr,null,e.createElement(a.td,null,e.createElement(a.strong,null,"U")),e.createElement(a.td,null,"update"),e.createElement(a.td,null,"post")),e.createElement(a.tr,null,e.createElement(a.td,null,e.createElement(a.strong,null,"D")),e.createElement(a.td,null,"destroy"),e.createElement(a.td,null,"delete")))),"\n",e.createElement(a.p,null,"Ниже приводится пример создаваемых маршрутов сразу с комментариями."),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># -*- coding: utf-8 -*-</span>\n<span class="token comment"># app/routes.rb</span>\n\n<span class="token comment"># получить главную страницу</span>\n<span class="token comment"># отобрать последние 10 постов</span>\nget <span class="token string-literal"><span class="token string">\'/\'</span></span> <span class="token keyword">do</span>\n  <span class="token comment"># сортировка и указание лимита</span>\n  <span class="token variable">@posts</span> <span class="token operator">=</span> Post<span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"created_at DESC"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>limit<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>\n  <span class="token comment"># для отображения взять /views/index.erb</span>\n  erb <span class="token symbol">:index</span>\n<span class="token keyword">end</span>\n\n<span class="token comment"># получить отдельный пост по его ID</span>\nget <span class="token string-literal"><span class="token string">\'/posts/:id/\'</span></span> <span class="token keyword">do</span>\n  <span class="token comment"># найти пост</span>\n  <span class="token variable">@post</span> <span class="token operator">=</span> Post<span class="token punctuation">.</span>find<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n  <span class="token variable">@title</span> <span class="token operator">=</span> <span class="token variable">@post</span><span class="token punctuation">.</span>title\n  <span class="token variable">@content</span> <span class="token operator">=</span> <span class="token variable">@post</span><span class="token punctuation">.</span>content\n  erb <span class="token operator">:</span><span class="token string-literal"><span class="token string">\'posts/show\'</span></span>\n<span class="token keyword">end</span>\n\n<span class="token comment"># отобразить форму для создания нового поста</span>\nget <span class="token string-literal"><span class="token string">\'/posts/new\'</span></span> <span class="token keyword">do</span>\n  <span class="token variable">@title</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">\'Create new post\'</span></span>\n  erb <span class="token operator">:</span><span class="token string-literal"><span class="token string">\'posts/create\'</span></span>\n<span class="token keyword">end</span>\n\n<span class="token comment"># взять параметры из формы и сохранить пост</span>\npost <span class="token string-literal"><span class="token string">\'/posts/new\'</span></span> <span class="token keyword">do</span>\n  params<span class="token punctuation">.</span>delete <span class="token string-literal"><span class="token string">\'submit\'</span></span>\n  <span class="token variable">@post</span> <span class="token operator">=</span> Post<span class="token punctuation">.</span>create<span class="token punctuation">(</span>params<span class="token punctuation">)</span>\n\n  <span class="token keyword">if</span> <span class="token variable">@post</span><span class="token punctuation">.</span>save\n    redirect to <span class="token string-literal"><span class="token string">\'/\'</span></span>\n  <span class="token keyword">else</span>\n    <span class="token string-literal"><span class="token string">\'Post was not save\'</span></span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span>\n\n<span class="token comment"># страница about</span>\n<span class="token comment"># запись вида (\'/about/?\') позволит</span>\n<span class="token comment"># обращаться как к странице /about</span>\n<span class="token comment"># так и к странице /about/</span>\nget <span class="token punctuation">(</span><span class="token string-literal"><span class="token string">\'/about/?\'</span></span><span class="token punctuation">)</span> <span class="token keyword">do</span>\n  <span class="token variable">@title</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">\'About me\'</span></span>\n  erb <span class="token symbol">:about</span>\n<span class="token keyword">end</span>\n\n<span class="token comment"># если страница не найдена</span>\nnot_found <span class="token keyword">do</span>\n  <span class="token variable">@title</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">\'Page not found\'</span></span>\n  <span class="token comment"># создайте для неё шаблон 404.erb</span>\n  erb <span class="token operator">:</span><span class="token string-literal"><span class="token string">\'404\'</span></span>\n<span class="token keyword">end</span>\n\n<span class="token comment"># обработка ошибки сервера</span>\nerror <span class="token keyword">do</span>\n  <span class="token variable">@error</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">\'sinatra_error\'</span></span><span class="token punctuation">]</span><span class="token punctuation">.</span>name\n  erb <span class="token operator">:</span><span class="token string-literal"><span class="token string">\'500\'</span></span>\n<span class="token keyword">end</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Надеюсь, комментарии смогли дать какое-то представление о маршрутизации в\nsinatra. Дальше напишем шаблоны страниц, содержимое которых будет динамическим."),"\n",e.createElement(a.p,null,"На главной странице отобразим список последних десяти публикаций, снабдим каждую\nзапись ссылкой на её полную версию."),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="erb"><pre class="language-erb"><code class="language-erb"><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"><span class="token comment"># views/index.erb </span></span><span class="token delimiter punctuation">%></span></span>\n\n<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"> <span class="token variable">@posts</span><span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>post<span class="token operator">|</span> </span><span class="token delimiter punctuation">%></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/posts/<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> post<span class="token punctuation">.</span>id </span><span class="token delimiter punctuation">%></span></span>/<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> post<span class="token punctuation">.</span>title </span><span class="token delimiter punctuation">%></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>\n<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"> <span class="token keyword">end</span> </span><span class="token delimiter punctuation">%></span></span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Страница отдельного поста будет отображать его заголовок и тело."),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="erb"><pre class="language-erb"><code class="language-erb"><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"><span class="token comment"># views/posts/show.erb </span></span><span class="token delimiter punctuation">%></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> <span class="token variable">@post</span><span class="token punctuation">.</span>title </span><span class="token delimiter punctuation">%></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> <span class="token variable">@post</span><span class="token punctuation">.</span>created_at </span><span class="token delimiter punctuation">%></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> <span class="token variable">@post</span><span class="token punctuation">.</span>content </span><span class="token delimiter punctuation">%></span></span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Для ручного добавления новых статей нам понадобится форма."),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="erb"><pre class="language-erb"><code class="language-erb"><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"><span class="token comment"># views/posts/create.erb </span></span><span class="token delimiter punctuation">%></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/posts/new<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">></span></span>Post title:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 250px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>\n\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Post content:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> 250px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">></span></span>\n\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Create post<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Теперь можно запустить shotgun, проверить как отображаются\n«мигрированные» публикации, а также, добавив к адресу главной\nстраницы ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">posts/new</code>'}}),", создать новый пост вручную."),"\n",e.createElement(a.p,null,"После того, как читатель получил удовлетворение от первых успехов своих,\nпереведя дух, предлагается ему дальнейшее следование CDRU: научимся изменять и\nудалять данные."),"\n",e.createElement(a.p,null,e.createElement(a.strong,null,"Изменение/Обновление")),"\n",e.createElement(a.p,null,"Для изменения уже существующих публикаций заведём соответствующие этим\nнамерениям маршруты и страницу."),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># app/routes.rb</span>\n<span class="token comment"># получаем страницу с формой редактирования</span>\nget <span class="token string-literal"><span class="token string">\'/posts/:id/edit/\'</span></span> <span class="token keyword">do</span>\n  <span class="token variable">@title</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">\'Update post\'</span></span>\n  <span class="token variable">@post</span> <span class="token operator">=</span> Post<span class="token punctuation">.</span>find<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n  erb <span class="token operator">:</span><span class="token string-literal"><span class="token string">\'posts/edit\'</span></span>\n<span class="token keyword">end</span>\n\n<span class="token comment"># обновляем данные</span>\nput <span class="token string-literal"><span class="token string">\'/posts/:id/edit/\'</span></span> <span class="token keyword">do</span>\n  <span class="token variable">@post</span> <span class="token operator">=</span> Post<span class="token punctuation">.</span>find<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n  <span class="token keyword">if</span> <span class="token variable">@post</span><span class="token punctuation">.</span>update_attributes<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:post</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n    redirect to <span class="token string-literal"><span class="token string">\'/\'</span></span>\n  <span class="token keyword">else</span>\n    erb <span class="token operator">:</span><span class="token string-literal"><span class="token string">\'posts/edit\'</span></span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Вот как может выглядеть сама формочка:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="erb"><pre class="language-erb"><code class="language-erb"><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"><span class="token comment"># views/posts/edit.erb </span></span><span class="token delimiter punctuation">%></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>Edit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/posts/<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> <span class="token variable">@post</span><span class="token punctuation">.</span>id </span><span class="token delimiter punctuation">%></span></span>/delete/<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>delete this post<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/posts/<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> <span class="token variable">@post</span><span class="token punctuation">.</span>id </span><span class="token delimiter punctuation">%></span></span>/edit/<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_method<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>put<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Title:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post[title]<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> <span class="token variable">@post</span><span class="token punctuation">.</span>title </span><span class="token delimiter punctuation">%></span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">></span></span>Post content:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post[content]<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> 250px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> <span class="token variable">@post</span><span class="token punctuation">.</span>content </span><span class="token delimiter punctuation">%></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">></span></span>\n\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">itype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Save<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Теперь попробуйте обновить какую-либо статью и приступайте к последнему таинству\n— удалению."),"\n",e.createElement(a.p,null,e.createElement(a.strong,null,"Удаление")),"\n",e.createElement(a.p,null,"Дальнейшее повествование описывает создание маршрутов и страницы, на которую станем\nперенаправлять пользователя, дабы убедиться действительно ли жаждет он\nрасстаться со своими материалами. Поехали."),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># app/routes.rb</span>\n<span class="token comment"># получить страницу</span>\nget <span class="token string-literal"><span class="token string">\'/posts/:id/delete/\'</span></span> <span class="token keyword">do</span>\n  <span class="token variable">@title</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">\'Confirm deletion of article #</span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span></span><span class="token delimiter punctuation">}</span></span><span class="token string">\'</span></span>\n  <span class="token variable">@post</span> <span class="token operator">=</span> Post<span class="token punctuation">.</span>find<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n  erb <span class="token operator">:</span><span class="token string-literal"><span class="token string">\'posts/delete\'</span></span>\n<span class="token keyword">end</span>\n\n<span class="token comment"># удалить публикацию</span>\ndelete <span class="token string-literal"><span class="token string">\'/posts/:id/\'</span></span> <span class="token keyword">do</span>\n  Post<span class="token punctuation">.</span>find<span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:id</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>destroy\n  redirect to <span class="token string-literal"><span class="token string">\'/\'</span></span>\n<span class="token keyword">end</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Ни в каких формах мы более не нуждаемся, хотя неплохо было бы уточнить\nдействительно ли пост должен быть удалён:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="erb"><pre class="language-erb"><code class="language-erb"><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"><span class="token comment"># views/posts/delete.erb </span></span><span class="token delimiter punctuation">%></span></span>\n\n<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"> <span class="token keyword">if</span> <span class="token variable">@post</span> </span><span class="token delimiter punctuation">%></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Are you sure?<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/posts/<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> <span class="token variable">@post</span><span class="token punctuation">.</span>id </span><span class="token delimiter punctuation">%></span></span>/<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_method<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>delete<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Yes, Delete It!<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"><span class="token string-literal"><span class="token string">"</span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content"><span class="token constant">SITE_URL</span></span><span class="token delimiter punctuation">}</span></span><span class="token string">"</span></span></span><span class="token delimiter punctuation">%></span></span>/posts/<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> <span class="token variable">@post</span><span class="token punctuation">.</span>id </span><span class="token delimiter punctuation">%></span></span>/<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Cancel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>\n<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"> <span class="token keyword">else</span> </span><span class="token delimiter punctuation">%></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Post not found.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"> <span class="token keyword">end</span> </span><span class="token delimiter punctuation">%></span></span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Прежде, чем двинуться дальше, рекомендуется ещё немного поэкспериментировать с\nэтим."),"\n",e.createElement(a.h2,{id:"валидация",style:{position:"relative"}},e.createElement(a.a,{href:"#%D0%B2%D0%B0%D0%BB%D0%B8%D0%B4%D0%B0%D1%86%D0%B8%D1%8F","aria-label":"валидация permalink",className:"anchor before"},e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Валидация"),"\n",e.createElement(a.p,null,"Пришло время существенно улучшить наше приложение и воспользоваться ещё одной\nособенностью, данной нам ActiveRecord: валидацией данных. Иметь валидные данные\n— значит иметь проверенные данные. Например, очень важно, чтобы при\nсоздании новой публикации она не осталась безымянной. Статья просто обязана\nиметь заголовок!"),"\n",e.createElement(a.p,null,"Что же, сделаем так, чтобы невозможно было этот самый заголовок пропустить (в\nпротивном случае данные не будут сохранены в базе). Обратимся к уже подзабытому\nфайлу с моделью."),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># app/models.rb</span>\n<span class="token keyword">class</span> <span class="token class-name">Post</span> <span class="token operator">&lt;</span> ActiveRecord<span class="token double-colon punctuation">::</span>Base\n  <span class="token comment"># заголовок с максимальной длиной в 100 символов!</span>\n  validates <span class="token symbol">:title</span><span class="token punctuation">,</span> <span class="token symbol">presence</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token symbol">length</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token symbol">maximum</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">}</span>\n  validates <span class="token symbol">:content</span><span class="token punctuation">,</span> <span class="token symbol">presence</span><span class="token operator">:</span> <span class="token boolean">true</span>\n<span class="token keyword">end</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Сейчас попробуйте сохранить новый пост без указания заголовка или с длиной,\nпревышающей сотню символов. При попытке сохранения вы должны получить ошибку, а\nобъект не будет сохранён в БД."),"\n",e.createElement(a.h2,{id:"отложенные-публикации",style:{position:"relative"}},e.createElement(a.a,{href:"#%D0%BE%D1%82%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5-%D0%BF%D1%83%D0%B1%D0%BB%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D0%B8","aria-label":"отложенные публикации permalink",className:"anchor before"},e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Отложенные публикации"),"\n",e.createElement(a.p,null,"С основополагающими принципами немного разобрались. Следующим шагом будет\nпростенькое добавление отложенных публикаций. Для этого прежде всего следует\nизменить миграцию."),"\n",e.createElement(a.h3,{id:"миграция",style:{position:"relative"}},e.createElement(a.a,{href:"#%D0%BC%D0%B8%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D1%8F","aria-label":"миграция permalink",className:"anchor before"},e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Миграция"),"\n",e.createElement(a.p,null,"Добавление всего одного параметра даты, который при написании статьи вводится вручную и\nпризван обозначать время публикации этой самой статьи:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># db/migrate/xxx_create_post.rb</span>\n<span class="token keyword">class</span> <span class="token class-name">CreatePost</span> <span class="token operator">&lt;</span> ActiveRecord<span class="token double-colon punctuation">::</span>Migration\n  <span class="token keyword">def</span> <span class="token method-definition"><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">up</span></span>\n    create_table <span class="token symbol">:posts</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>\n      t<span class="token punctuation">.</span>date     <span class="token symbol">:published_at</span>\n    <span class="token keyword">end</span>\n    Post<span class="token punctuation">.</span>create<span class="token punctuation">(</span>\n      <span class="token symbol">title</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"Who I am?"</span></span><span class="token punctuation">,</span>\n      <span class="token symbol">published_at</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"2086-03-05"</span></span><span class="token punctuation">,</span>\n      <span class="token symbol">content</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">"You don\'t show me!"</span></span><span class="token punctuation">)</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"После этого необходимо прогуляться в сторону модели:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># app/models.rb</span>\n<span class="token keyword">class</span> <span class="token class-name">Post</span> <span class="token operator">&lt;</span> ActiveRecord<span class="token double-colon punctuation">::</span>Base\n  scope <span class="token symbol">:published_at</span><span class="token punctuation">,</span> lambda <span class="token punctuation">{</span> where<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"published_at &lt;= ?"</span></span><span class="token punctuation">,</span> <span class="token builtin">Time</span><span class="token punctuation">.</span>now<span class="token punctuation">)</span> <span class="token punctuation">}</span>\n  validates <span class="token symbol">:published_at</span><span class="token punctuation">,</span> <span class="token symbol">presence</span><span class="token operator">:</span> <span class="token boolean">true</span>\n<span class="token keyword">end</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Поскольку данные пока не представляют собой никакой ценности (их попросту нет),\nдля вступления в силу принятых изменений можно сделать ход конём:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ rake db:rollback\n$ rake db:migrate</code></pre></div>'}}),"\n",e.createElement(a.p,null,"Это откат прошлой миграции и создание новой. Все созданные вручную записи будут потеряны."),"\n",e.createElement(a.h3,{id:"вывод-публикаций",style:{position:"relative"}},e.createElement(a.a,{href:"#%D0%B2%D1%8B%D0%B2%D0%BE%D0%B4-%D0%BF%D1%83%D0%B1%D0%BB%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D0%B9","aria-label":"вывод публикаций permalink",className:"anchor before"},e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Вывод публикаций"),"\n",e.createElement(a.p,null,"Что же, настало время обратиться к маршрутам и там, где это нужно, указать новую\nвыборку. Например, при выводе публикаций на главной странице:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># app/routes.rb</span>\nget <span class="token string-literal"><span class="token string">\'/\'</span></span> <span class="token keyword">do</span>\n  <span class="token variable">@summary</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">\'Blog description\'</span></span>\n  <span class="token comment"># отображать только опубликованные статьи</span>\n  <span class="token variable">@posts</span> <span class="token operator">=</span> Post<span class="token punctuation">.</span>published_at<span class="token punctuation">.</span>limit<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>\n  erb <span class="token symbol">:index</span>\n<span class="token keyword">end</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Это не единственный (и, возможно, не самый лучший) способ создать отложенные\nпубликации, но первый, что пришёл в голову."),"\n",e.createElement(a.h2,{id:"отображение-дат",style:{position:"relative"}},e.createElement(a.a,{href:"#%D0%BE%D1%82%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%B0%D1%82","aria-label":"отображение дат permalink",className:"anchor before"},e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Отображение дат"),"\n",e.createElement(a.p,null,"Если читатель проделал на практике все шаги вплоть до этого момента, он мог\nзаметить, что формат даты нельзя назвать «человекопонятным». Пришло\nвремя узнать зачем в sinatra используются хелперы."),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># app/helpers.rb</span>\n\nhelpers <span class="token keyword">do</span>\n  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">pretty_date</span></span><span class="token punctuation">(</span>time<span class="token punctuation">)</span>\n    <span class="token comment"># форматируем дату</span>\n    time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"%d %b %Y"</span></span><span class="token punctuation">)</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Теперь там, где это представляется необходимым, следует использовать подобную\nконструкцию для вывода симпатичных дат:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="erb"><pre class="language-erb"><code class="language-erb"><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"><span class="token comment"># views/posts/show.erb </span></span><span class="token delimiter punctuation">%></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> <span class="token variable">@post</span><span class="token punctuation">.</span>title </span><span class="token delimiter punctuation">%></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> pretty_date<span class="token punctuation">(</span><span class="token variable">@post</span><span class="token punctuation">.</span>published_at<span class="token punctuation">)</span> </span><span class="token delimiter punctuation">%></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre></div>'}}),"\n",e.createElement(a.h2,{id:"markdown-и-архив-публикаций",style:{position:"relative"}},e.createElement(a.a,{href:"#markdown-%D0%B8-%D0%B0%D1%80%D1%85%D0%B8%D0%B2-%D0%BF%D1%83%D0%B1%D0%BB%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D0%B9","aria-label":"markdown и архив публикаций permalink",className:"anchor before"},e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Markdown и архив публикаций"),"\n",e.createElement(a.p,null,"На самом деле, эти вещи уже были описаны ранее."),"\n",e.createElement(a.p,null,"Для того, чтобы получить возможность писать статью при помощи markdown-разметки,\nа сохранять и отображать её в виде html, достаточно взять блок кода из второго\nпримера, где используется ",e.createElement(a.a,{href:"/posts/rails-markdown/"},"before_save"),". Код этот\nпомещается в ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">app/models.rb</code>'}}),", в шаблоне вывода публикации ничего править не\nнужно."),"\n",e.createElement(a.p,null,"То же самое с созданием архива. Один из способов описан в публикации об\n",e.createElement(a.a,{href:"/posts/rails-archive/"},"упорядочивании записей в rails"),". С\nнашей организацией проекта это будет выглядеть не совсем так:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token comment"># app/routes.rb</span>\n<span class="token comment"># Archive</span>\n\n<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">\'/archive/?\'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string-literal"><span class="token string">\'/posts/?\'</span></span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>route<span class="token operator">|</span>\n  get route <span class="token keyword">do</span>\n    <span class="token variable">@posts</span> <span class="token operator">=</span> Post<span class="token punctuation">.</span>published_at\n    <span class="token variable">@posts_by_year</span> <span class="token operator">=</span> Post<span class="token punctuation">.</span>published_at<span class="token punctuation">.</span>order<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"published_at ASC"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>limit<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">.</span>group_by <span class="token punctuation">{</span> <span class="token operator">|</span>post<span class="token operator">|</span> post<span class="token punctuation">.</span>published_at<span class="token punctuation">.</span>beginning_of_year <span class="token punctuation">}</span>\n    <span class="token variable">@title</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">\'Archive\'</span></span>\n    erb <span class="token symbol">:archive</span>\n  <span class="token keyword">end</span>\n<span class="token keyword">end</span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Вывод страниц:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="erb"><pre class="language-erb"><code class="language-erb"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> <span class="token variable">@title</span> </span><span class="token delimiter punctuation">%></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>\n\n<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"> <span class="token variable">@posts_by_year</span><span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>year<span class="token punctuation">,</span> posts<span class="token operator">|</span> </span><span class="token delimiter punctuation">%></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> <span class="token string-literal"><span class="token string">"</span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">year<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">\'%Y\'</span></span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">}</span></span><span class="token string">"</span></span> </span><span class="token delimiter punctuation">%></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dl</span><span class="token punctuation">></span></span>\n    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"> <span class="token keyword">for</span> post <span class="token keyword">in</span> posts </span><span class="token delimiter punctuation">%></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/posts/<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> post<span class="token punctuation">.</span>id </span><span class="token delimiter punctuation">%></span></span>/<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> post<span class="token punctuation">.</span>title </span><span class="token delimiter punctuation">%></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>\n       <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span><span class="token ruby language-ruby"> pretty_date<span class="token punctuation">(</span>post<span class="token punctuation">.</span>published_at<span class="token punctuation">)</span> </span><span class="token delimiter punctuation">%></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">></span></span>\n    <span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"> <span class="token keyword">end</span> </span><span class="token delimiter punctuation">%></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dl</span><span class="token punctuation">></span></span>\n<span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%</span><span class="token ruby language-ruby"> <span class="token keyword">end</span> </span><span class="token delimiter punctuation">%></span></span></code></pre></div>'}}),"\n",e.createElement(a.p,null,"Эффект обеспечен тот же самый."),"\n",e.createElement(a.h2,{id:"развёртывание-приложения-на-heroku",style:{position:"relative"}},e.createElement(a.a,{href:"#%D1%80%D0%B0%D0%B7%D0%B2%D1%91%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BD%D0%B0-heroku","aria-label":"развёртывание приложения на heroku permalink",className:"anchor before"},e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Развёртывание приложения на Heroku"),"\n",e.createElement(a.p,null,"Прежде всего следует удостовериться, что файлы ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">Gemfile</code>'}})," и ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">config.ru</code>'}})," расположены в\nкорне проекта, который вы собираетесь развёртывать. Затем создать аккаунт на\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">heroku.com</code>'}})," и установить ",e.createElement(a.a,{href:"https://toolbelt.heroku.com/",target:"_blank",rel:"nofollow"},"Heroku Toolbelt"),":"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ <span class="token function">wget</span> -qO- https://toolbelt.heroku.com/install.sh <span class="token operator">|</span> <span class="token function">sh</span>\n$ <span class="token builtin class-name">echo</span> <span class="token string">\'PATH="/usr/local/heroku/bin:$PATH"\'</span> <span class="token operator">>></span> ~/.profile\n$ heroku login</code></pre></div>'}}),"\n",e.createElement(a.p,null,"После чего сделать из нашего каталога git-репозиторий:"),"\n",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ <span class="token function">git</span> init\n$ <span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>\n$ <span class="token function">git</span> commit <span class="token parameter variable">-am</span> <span class="token string">\'initial commit\'</span>\n$ heroku create\n$ <span class="token function">git</span> push heroku master\n$ heroku run rake <span class="token parameter variable">--trace</span> db:migrate</code></pre></div>'}}),"\n",e.createElement(a.blockquote,null,"\n",e.createElement(a.p,null,"Чтобы указать какую-то определённую миграцию используйте db:migrate\nVERSION=xxx"),"\n"),"\n",e.createElement(a.blockquote,null,"\n",e.createElement(a.p,null,"Если что-то пошло не так, посмотрите логи командой heroku logs"),"\n"),"\n",e.createElement(a.p,null,"Надо также заметить, что строка, указывающая порт в ",e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">config.ru</code>'}})," должна быть в\nобязательном порядке удалена перед деплоем на heroku."),"\n",e.createElement(a.h2,{id:"послесловие",style:{position:"relative"}},e.createElement(a.a,{href:"#%D0%BF%D0%BE%D1%81%D0%BB%D0%B5%D1%81%D0%BB%D0%BE%D0%B2%D0%B8%D0%B5","aria-label":"послесловие permalink",className:"anchor before"},e.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Послесловие"),"\n",e.createElement(a.p,null,"Сегодня было раскрыто многое из того, что можно сделать с помощью sinatra, но\nещё больше осталось за кадром. Как кэшировать страницы, как защитить админку,\nчто можно использовать кроме ActiveRecord, какой может быть архитектура\nприложения (а она имеет полное право разительно отличаться от того, что было представлено в заметке),\nкак генерировать rss-ленту, как тестировать приложение. Ответы на эти и другие вопросы следует искать прежде всего в\nследующих источниках:"),"\n",e.createElement(a.ul,null,"\n",e.createElement(a.li,null,e.createElement(a.a,{href:"http://www.sinatrarb.com/",target:"_blank",rel:"nofollow"},"http://www.sinatrarb.com/")),"\n",e.createElement(a.li,null,e.createElement(a.a,{href:"http://recipes.sinatrarb.com/",target:"_blank",rel:"nofollow"},"http://recipes.sinatrarb.com/")),"\n",e.createElement(a.li,null,e.createElement(a.a,{href:"http://rspec.info/",target:"_blank",rel:"nofollow"},"http://rspec.info/")),"\n"))}var l=function(n){void 0===n&&(n={});const{wrapper:a}=Object.assign({},(0,t.MN)(),n.components);return a?e.createElement(a,n,e.createElement(p,n)):p(n)},o=s(7792),c=s(7619);function r(n){var a,s;let{data:{mdx:t},children:p,pageContext:{prev:l,next:r}}=n;const{h1:u,title:i,description:k,image:g,table_of_contents:d}=t.frontmatter;return(0,e.useEffect)((()=>{(0,c.K)()}),[]),e.createElement(e.Fragment,null,e.createElement(o._W,{h1:u,title:i,description:k,image:null===(a=t.frontmatter.image)||void 0===a?void 0:a.publicURL},e.createElement(o.MV,{post:t.frontmatter,imageData:null==g||null===(s=g.childImageSharp)||void 0===s?void 0:s.gatsbyImageData},d?e.createElement(o.G8,{headings:t.tableOfContents}):null,e.createElement("div",{className:"page__content"},p,e.createElement(o.Mf,{prev:l,next:r})),e.createElement(o.QZ,null))))}function u(n){return e.createElement(r,n,e.createElement(l,n))}},8876:function(n,a,s){s.d(a,{MN:function(){return p}});var t=s(4424);const e=t.createContext({});function p(n){const a=t.useContext(e);return t.useMemo((()=>"function"==typeof n?n(a):{...a,...n}),[a,n])}}}]);